<!DOCTYPE HTML>
<!--
	Massively by HTML5 UP
	html5up.net | @ajlkn
  Jekyll integration by somiibo.com
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

	<title>Welcome to Nimiq Community Site</title>
	<meta name="description" content="">

	<link rel="apple-touch-icon" sizes="180x180" href="/assets/icon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/assets/icon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/assets/icon/favicon-16x16.png">
	<link rel="manifest" href="/assets/icon/manifest.json">
	<link rel="mask-icon" href="/assets/icon/safari-pinned-tab.svg" color="#5bbad5">
	<link rel="shortcut icon" href="/assets/icon/favicon.ico">
	<meta name="msapplication-config" content="/assets/icon/browserconfig.xml">
	<meta name="theme-color" content="#ffffff">

	<!-- CSS -->
	<link rel="stylesheet" href="/assets/css/main.css">
	<noscript><link rel="stylesheet" href="/assets/css/noscript.css"></noscript>

</head>

<body class="is-loading">

	<!-- Wrapper -->
	<div id="wrapper" class="fade-in">

		<!-- Header -->
		<header id="header">
			<a href="/" class="logo">Nimiq Community</a>
		</header>

		<!-- Nav -->
		<nav id="nav">

			<ul class="links">
				<li class=""><a href="/">Start Here</a></li>
				<li class=""><a href="/benchmark/">Mining Benchmark</a></li>
				<li class=""><a href="/projects/">Community Projects</a></li>
				<li class="active"><a href="/tutorials/">Tutorials</a></li>
				<li class=""><a href="/blog/">Blog</a></li>
				<li class=""><a href="/fanart/">Fanart</a></li>
			</ul>


			<ul class="icons">
				<li><a href="https://twitter.com/nimiq" class="icon fa-twitter" rel="nofollow"><span class="label">Twitter</span></a></li>
				<li><a href="https://facebook.com/nimiq" class="icon fa-facebook" rel="nofollow"><span class="label">Facebook</span></a></li>
				<li><a href="https://telegram.me/nimiq" class="icon fa-comment" rel="nofollow"><span class="label">Instagram</span></a></li>
				<li><a href="https://github.com/nimiq" class="icon fa-github" rel="nofollow"><span class="label">GitHub</span></a></li>
			</ul>
		</nav>

		<!-- Main -->
		<div id="main">

			<section class="post">

				<header class="major">
					<span class="date">22 Dec 2017</span>
					<h1>Running a Node.js Miner for Nimiq</h1>
					<p>A guide on setting up Node.js miner for Nimiq.</p>
				</header>
				<div class="image main"><img src="/images/nodejs_1.png" alt=""></div>

				<h2>Nimiq Mining</h2>

				<p>
					In this guide, we describe the steps required to configure a Node.js miner for Nimiq running on a server.
					Nimiq is the first blockchain built to be native to the Web platform. Since it is implemented in JavaScript,
					it is possible to mine Nimiq directly from the Web browser by simply going to a Web page
					(<a href="https://nimiq.com/miner">example for the Betanet</a>). However, a mining client is also implemented in
					Node.js, which is a cross-platform JavaScript run-time environment for executing JavaScript code server-side.
					Dedicated miners may want to set up a mining machine that runs the Node.js miner instead as it is faster while
					not requiring the browser to be open all the time. In this guide, we explain how to configure the Node.js miner for Nimiq.
				</p>

				<p>
					<strong>Difficulty: low/intermediate </strong> (you should be comfortable working in the UNIX environment).
				</p>

				<h2>1. Getting Started</h2>

				<p>
					The following are the pre-requisites to running the Node.js miner for Nimiq:
					<ul>
						<li>
							A server with a public IP address. Alternatively, you <strong>may</strong> be able to use a Virtual Private Server
							(VPS) to mine. However many VPS providers have terms-of-service that explicitly prohibit cryptocurrency mining and may suspend or
							limit your account upon excessive CPU usage.
						</li>
						<li>Ubuntu Linux 16.04 LTS, although other versions should work too.</li>
					</ul>
					Ensure that you can connect to the server via SSH from the terminal.
					Windows users may wish to use <a href="http://www.putty.org/">PuTTY</a>.
				</p>

				<h2>2. Securing the Server</h2>

				<p>
					Since the server is going to be connected to the Internet constantly, it is important to secure it.
					To do that, we will set up Uncomplicated Firewall (ufw)
					to restrict connections to/from the server, and run the Node.js miner under a non-root user account.
					Since it’s not a good idea to run the miner under the root account, here we create a new ‘nimiq’ user account.
					Type the command below to create a new user account, then fill in the password (you can leave everything else blank).
				</p>

				<pre><code>$ adduser nimiq</code></pre>

				<p>
					Assign sudo privileges to this user so it is possible to run commands with superuser privileges.
				</p>

				<pre><code>$ usermod -aG sudo nimiq</code></pre>

				<p>
					Exit, and connect again via SSH as the newly created nimiq user (you can also use ssh-copy-id if you already have your SSH keys
					and don’t want to keep typing login password). In this guide, we will use 51.15.206.160 as an example throughout – but
					it should be different to yours.
				</p>

				<pre><code>$ ssh nimiq@51.15.206.160</code></pre>

				<p>
					In Ubuntu, we can use Uncomplicated Firewall (ufw) -- a frontend for iptables that provides an easy to use interface
					for people unfamiliar with firewall. Type the commands below in the shell to enable ufw.
					By default, ufw will deny all incoming connections and allow all outgoing connections, so we need to allow basic SSH connections
					(otherwise we won't be able to connect to our server). In the last command, the status from ufw should show as ‘active’.
				</p>

				<pre><code>$ sudo apt-get install ufw
$ sudo ufw allow ssh
$ sudo ufw enable
$ sudo ufw status</code></pre>

				<p>
					To run a NodeJs Client you will need a publicly routable IP, Domain and SSL Certificate (get a free one at letsencrypt.org), so in
					the next section we describe how to configure these.
				</p>

				<h2>3. Obtain a Domain Name</h2>

				<p>
					Before we can get the SSL certificate that we need to run our miner, we need a domain name. You could register
					for a domain name from many places, like <a href="https://www.godaddy.com/">GoDaddy</a>, <a href="https://www.namecheap.com">NameCheap</a>, etc.
					Once the domain name is registered, you need to configure the DNS record for Letsencrypt (see here for <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-let-s-encrypt-with-nginx-server-blocks-on-ubuntu-16-04">a guide to do this</a>).
				</p>
				<p>
					Otherwise, if you don't want to spend any money, you could register for a free domain name from <a href="http://www.dot.tk">Dot.tk</a>.
					As an example, the screenshot below shows how we register for mynimiqminer01.cf from Dot.tk.
				</p>
				<div class="image main"><img src="/images/nodejs_2.png" alt=""></div>
				<p>
					From the next page of the registration page, make sure to select the Use DNS option, and enter the IP address of your server
					in the A record fields. You need to add two A records to connect the IP to the domain name, one that starts with ‘www’ (e.g. http://www.mynimiqminer01.cf)
					and another with nothing before it (e.g. http://mynimiqminer01.cf). Finish the registration process. You could use whois to confirm
					that the registration has been processed -- usually after 15 minutes or so.
				</p>
				<div class="image main"><img src="/images/nodejs_3.png" alt=""></div>
				<p>
					The free DNS provider (FreeNOM) doesn’t like it if we are squatting on domain that does not have an accessible website, so we are also going to set up a placeholder page
					using <a href="https://www.nginx.com/">Nginx</a>. If you’re using a paid domain, feel free to skip this step (but you should still open port 80 and 443 anyway for the Node.js miner to work).
					Connect to the server again via SSH and type the following commands to install Nginx:
				</p>
				<pre><code>$ sudo apt-get update
$ sudo apt-get install nginx</code></pre>
				<p>Now we need to adjust the firewall again to open port 80 (http) and 443 (https).</p>
				<pre><code>$ sudo ufw app list
$ sudo ufw allow ‘Nginx Full’
$ sudo ufw status</code></pre>
				<p>
					If Nginx is running correctly, you should see a welcome message by going to the IP address of the server from your browser. Once the domain name has been registered,
					you could go to that domain name from your browser as well. For e.g. <a href="http://51.15.206.160">51.15.206.160</a>, <a href="http://mynimiqminer01.cf">mynimiqminer01.cf</a> and
					<a href="http://www.mynimiqminer01.cf">www.mynimiqminer01.cf</a> all load the welcome page for Nginx that we set up in the earlier sections.
				</p>

				<h2>4. Generate Let's Encrypt SSL Certificate</h2>

				<p>
					Now we need to get an SSL certificate (issued by Let's Encrypt) using the <a href="https://certbot.eff.org/">EFF's Certbot</a>.
					Note that you need port 80 and 443 open. Refer to the last part of Step 3 if you haven’t done so. Next, type the following commands to install the certbot:
				</p>
				<pre><code>$ sudo apt-get update
$ sudo apt-get install software-properties-common
$ sudo add-apt-repository ppa:certbot/certbot
$ sudo apt-get update
$ sudo apt-get install certbot</code></pre>

				<p>
					To obtain a cert using a built-in "standalone" webserver (you may need to temporarily stop your existing webserver, if any)
					for example.com and www.example.com, we type the following commands (shown here for mynimiqminer01.cf).
					Enter your email, accept the agreement and take note of the output of certbot.
				</p>

				<pre><code>$ sudo certbot certonly --standalone -d mynimiqminer01.cf -d www.mynimiqminer01.cf
IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at:
   /etc/letsencrypt/live/mynimiqminer01.cf/fullchain.pem
   Your key file has been saved at:
   /etc/letsencrypt/live/mynimiqminer01.cf/privkey.pem
   Your cert will expire on 2018-03-22. To obtain a new or tweaked
   version of this certificate in the future, simply run certbot
   again. To non-interactively renew *all* of your certificates, run
   "certbot renew"
 - Your account credentials have been saved in your Certbot
   configuration directory at /etc/letsencrypt. You should make a
   secure backup of this folder now. This configuration directory will
   also contain certificates and private keys obtained by Certbot so
   making regular backups of this folder is ideal.</code></pre>

   				<p>
					Next, we want to verify that auto-renewal works. You shouldn’t see any error from the command below.
				</p>
				<pre><code>$ sudo certbot renew --dry-run</code></pre>
				<p>
					We also need to set the permission so non-root users can access these certificate files.
				</p>
				<pre><code>$ sudo chmod 755 /etc/letsencrypt/live
$ sudo chmod 755 /etc/letsencrypt/archive</code></pre>

				<h2>5. Installing Nimiq Node.js Miner</h2>

				<p>Now we have everything we need to install the Node.js server and run the Node.js miner for Nimiq! To begin with,
					first we install version 8 and above of Node.js using the following commands:</p>

				<pre><code>$ curl -sL https://deb.nodesource.com/setup_9.x -o nodesource_setup.sh
$ sudo bash nodesource_setup.sh
$ sudo apt-get install nodejs build-essential git</code></pre>

				<p>Next, using Node Package Manager (npm), we install Gulp -- a toolkit for automating painful or time-consuming tasks in development workflow -- globally for all users.

				<pre><code>$ sudo npm install -g gulp</code></pre>

				<p>Finally we can clone the Github repository for nimiq, and checkout the <strong>release</strong> branch.</p>

				<pre><code>$ cd ~
$ git clone https://github.com/nimiq-network/core
$ cd core
$ git checkout release</code></pre>

				<p>Install and build the project using npm</p>

				<pre><code>$ npm install
$ npm run build</code></pre>

				<p>
					To run the Node.js miner for Nimiq, we need a publicly routable IP, a domain name and an SSL certificate. Now we have everything we need!
					Start the client by running clients/nodejs/index.js. To adjust the number of threads, provide the option to the miner parameter in the command
					below, e.g. --miner=2 to use two threads.
				</p>

				<pre><code>$ cd ~/core/clients/nodejs/
$ node index.js --host mynimiqminer01.cf --port 8080 \
--key /etc/letsencrypt/live/mynimiqminer01.cf/privkey.pem \
--cert /etc/letsencrypt/live/mynimiqminer01.cf/fullchain.pem \
--miner=2</code></pre>

				<p>
					Take note of the first two lines produced by the node command. That shows your wallet address that the miner is using.
					Eventually you should see messages that the blocks are downloading.
					Wait until you catch up to the latest block at <a href="https://nimiq.watch/">Nimiq.Watch</a>.
					The miner is now running if you see lines that begin with the word ‘Miner’. Congratulations!
					As an optional step, you can use <strong>pm2</strong>, which is a process manager for Node.js applications, to
					manage and run the miner as a background service. This is described in the next section of this guide.
				</p>

				<pre><code>[I 05:57:48] Node: Wallet initialized for address NQ36 99EY F5G7 VG20 KDEX RL38 TLVU CCKG C7TF.
[I 05:57:48] Node: Blockchain: height=1, totalWork=1.4116399577030896, headHash=K3Id+E/rgqR8SB8pV0X9Fxv4FxkC5eePu/oXVaj6ZO4=
...
[I 15:20:46] Node: Now at block: 5800
[I 15:20:46] Node: Now at block: 5900
[I 15:20:47] Node: Now at block: 6000
...
[I 15:35:23] Miner: Starting work on  … hashrate=2700 H/s
</code></pre>

				<h2>Configuring PM2</h2>

				<p>
					Now we want to keep the miner running, even after we disconnect from our SSH session. We can do this through <a href="http://pm2.keymetrics.io/">PM2</a>, which is
					a process manager for Node.js application. Quit the miner (Ctrl-C) and type the commands below. Note now two dashes (--) are used to separate index.js and all the parameters that we pass to it.
				</p>

				<pre><code>$ sudo npm install -g pm2
$ pm2 start index.js -- --host mynimiqminer01.cf --port 8080 \
--key /etc/letsencrypt/live/mynimiqminer01.cf/privkey.pem \
--cert /etc/letsencrypt/live/mynimiqminer01.cf/fullchain.pem \
--miner=2</code></pre>

				<p>
					Ensure that the miner is running correctly under PM2 by looking at the list of applications managed by PM2 and also from the log files.
					You should not see any error in the log files. Now you can exit the SSH session and the miner will continue running in the background.
				</p>

				<pre><code>$ pm2 list
$ pm2 logs</code></pre>

				<p>
					Congratulations. Your Nimiq Node.js miner is now running! You can check how many NIMs you have mined by entering the wallet address used by the miner
					at block explorers, such as <a href="https://nimiq.watch">https://nimiq.watch</a> and <a href="https://nimiq.mopsus.com/">https://nimiq.mopsus.com/</a>.
				</p>
				<div class="image"><img src="/images/nodejs_4.png" alt=""></div>

				<p>
					<strong>TODO:</strong>
					<ul>
						<li>How to use a seed wallet?</li>
						<li>How to show balance while mining?</li>
						<li>Mining pool?</li>
					</ul>
				</p>

			</section>

			<div class="comments-wrapper">
				<div id="disqus_thread"></div>
				<script>
					/**
					 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
					 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
					 */

					var disqus_config = function() {
						this.page.url = '/blog/welcome-to-nimiq-community/'; /*Replace PAGE_URL with your page's canonical URL variable*/
						this.page.identifier = '/blog/welcome-to-nimiq-community/'; /*Replace PAGE_IDENTIFIER with your page's unique identifier variable*/
					};

					(function() { /* dont endit below this line */
						var d = document,
							s = d.createElement('script');

						s.src = 'https://default.disqus.com/embed.js';

						s.setAttribute('data-timestamp', +new Date());
						(d.head || d.body).appendChild(s);
					})();
				</script>
				<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
			</div>
			<!-- /.comments-wrapper -->

			<!-- Footer -->
			<footer>
				<ul class="actions">
					<li><a href="https://medium.com/nimiq-network" class="button">Official Blog</a></li>
				</ul>
			</footer>
		</div>

		<!-- Footer -->
		<footer id="footer">
			<section>
				<h2>Are you in? Write us here.</h2>
				<form method="POST" action="https://formspree.io/community@nimiq.com">
					<div class="field">
						<label for="name">Name</label>
						<input type="text" name="name" id="name">
					</div>
					<div class="field">
						<label for="email">Email</label>
						<input type="text" name="email" id="email">
					</div>
					<div class="field">
						<label for="message">Message</label>
						<textarea name="message" id="message" rows="3"></textarea>
					</div>
					<ul class="actions">
						<li><input type="submit" value="Send Message"></li>
					</ul>
				</form>
			</section>
			<section class="split contact">
				<section class="alt">
					<h3>Location</h3>
					<p>Santa Teresa, CR</p>
				</section>
				<section>
					<h3>Website</h3>
					<p><a href="https://nimiq.com">https://nimiq.com</a></p>
				</section>
				<section>
					<h3>Email</h3>
					<p><a href="mailto:community@nimiq.com">community@nimiq.com</a></p>
				</section>
				<section>
					<h3>Social</h3>
					<ul class="icons alt">
						<li><a href="https://twitter.com/nimiq" class="icon fa-twitter" rel="nofollow"><span class="label">Twitter</span></a></li>
						<li><a href="https://facebook.com/nimiq" class="icon fa-facebook" rel="nofollow"><span class="label">Facebook</span></a></li>
						<li><a href="https://telegram.me/nimiq" class="icon fa-comments" rel="nofollow"><span class="label">Instagram</span></a></li>
						<li><a href="https://github.com/nimiq" class="icon fa-github" rel="nofollow"><span class="label">GitHub</span></a></li>
					</ul>
				</section>
			</section>
		</footer>
		<!-- Copyright -->
		<div id="copyright">
			<ul>
				<li>© HTML5 UP</li>
				<li>Design by <a href="https://html5up.net">HTML5 UP</a>
				</li>
				<li>Jekyll Integration by <a href="https://somiibo.com">Somiibo</a>
				</li>
			</ul>
		</div>


	</div>

	<!-- Scripts -->
	<!-- DYN -->
	<script src="/assets/js/jquery.min.js"></script>
	<script src="/assets/js/jquery.scrollex.min.js"></script>
	<script src="/assets/js/jquery.scrolly.min.js"></script>
	<script src="/assets/js/skel.min.js"></script>
	<script src="/assets/js/util.js"></script>
	<script src="/assets/js/main.js"></script>

	<script async src="https://www.googletagmanager.com/gtag/js?id=default"></script>
	<script>
		window.dataLayer = window.dataLayer || [];

		function gtag() {
			dataLayer.push(arguments)
		};
		gtag('js', new Date());

		gtag('config', 'default');
	</script>

</body>

</html>